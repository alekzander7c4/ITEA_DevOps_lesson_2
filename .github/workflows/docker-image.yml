name: Docker Image CI

on:
  push:
    branches: [ main ]

jobs:

  build:

    runs-on: ubuntu-latest

    steps:
    - uses: actions/checkout@v2
    - run: echo "GITHUB_WORKFLOW- $GITHUB_WORKFLOW"
    - run: echo "GITHUB_RUN_ID- $GITHUB_RUN_ID"
    - run: echo "GITHUB_RUN_NUMBER- $GITHUB_RUN_NUMBER"
    - run: echo "GITHUB_JOB- $GITHUB_JOB"
    - run: echo "GITHUB_REPOSITORY- $GITHUB_REPOSITORY"
    - run: echo "GITHUB_EVENT_NAME- $GITHUB_EVENT_NAME"
    - run: echo "GITHUB_WORKSPACE- $GITHUB_WORKSPACE"
    - run: echo "GITHUB_REF- $GITHUB_REF"
#     - run: echo ::save-state name=RELEASE_VERSION::$(echo $GITHUB_RUN_NUMBER)
#     - run: echo "${{ env.STATE_RELEASE_VERSION }}"
#     - run: echo "${{ env.RELEASE_VERSION }}"
    - run: echo "STATE_RELEASE_VERSION=yellow" >> $GITHUB_ENV
    - run: echo "${{ env.STATE_RELEASE_VERSION }}"
    
#     - name: Build the Docker image
#       run: docker build . --file Dockerfile --tag my-image-name:$(date +%s)

    - name: Publish Docker
      uses: elgohr/Publish-Docker-Github-Action@3.04
      with:
        name: alekzander7c4/lesson3
        username: ${{ secrets.DOCKER_USERNAME }}
        password: ${{ secrets.DOCKER_PASSWORD }}
        tags: "latest,${{ env.STATE_RELEASE_VERSION }}"
